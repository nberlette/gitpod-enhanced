import{_ as e,c as a,o,d as s}from"./app.91265b5e.js";const f=JSON.parse('{"title":"Custom Dockerfile with Gitpod","description":"","frontmatter":{"title":"Custom Dockerfile with Gitpod"},"headers":[{"level":2,"title":"Configure a public Docker image","slug":"configure-a-public-docker-image"},{"level":3,"title":"Docker image tags","slug":"docker-image-tags"},{"level":2,"title":"Configure a custom Dockerfile","slug":"configure-a-custom-dockerfile"},{"level":2,"title":"Trying out changes to your Dockerfile","slug":"trying-out-changes-to-your-dockerfile"},{"level":3,"title":"In the existing workspace","slug":"in-the-existing-workspace"},{"level":3,"title":"As a new workspace","slug":"as-a-new-workspace"},{"level":2,"title":"Manually rebuild a workspace image","slug":"manually-rebuild-a-workspace-image"}],"relativePath":"gitpod-docker.md"}'),t={name:"gitpod-docker.md"},i=s(`<h1 id="custom-docker-images-with-gitpod" tabindex="-1">Custom Docker Images with Gitpod <a class="header-anchor" href="#custom-docker-images-with-gitpod" aria-hidden="true">#</a></h1><blockquote><p><strong>Note</strong>: this page is copied directly from <a href="https://gitpod.io/docs/custom-docker" target="_blank" rel="noopener noreferrer">the Gitpod documentation</a>.</p></blockquote><p>By default, Gitpod uses a standard Docker Image called <a href="https://github.com/gitpod-io/workspace-images/blob/481f7600b725e0ab507fbf8377641a562a475625/dazzle.yaml#L18" target="_blank" rel="noopener noreferrer"><code>Workspace-Full</code></a> as the foundation for workspaces. Workspaces started based on this default image come pre-installed with Docker, Nix, Go, Java, Node.js, C/C++, Python, Ruby, Rust, PHP as well as tools such as Homebrew, Tailscale, Nginx and several more.</p><p>If this image does not include the tools you need for your project, you can provide a public Docker image or your own <a href="#using-a-dockerfile">Dockerfile</a>. This provides you with the flexibility to install the tools &amp; libraries required for your project.</p><blockquote><p><strong>Note:</strong> Gitpod supports Debian/Ubuntu based Docker images. Alpine images do not include <a href="https://code.visualstudio.com/docs/remote/linux#_tips-by-linux-distribution" target="_blank" rel="noopener noreferrer">libgcc and libstdc++</a> which breaks Visual Studio Code. See also <a href="https://github.com/gitpod-io/gitpod/issues/3356" target="_blank" rel="noopener noreferrer">Issue #3356</a>.</p></blockquote><h2 id="configure-a-public-docker-image" tabindex="-1">Configure a public Docker image <a class="header-anchor" href="#configure-a-public-docker-image" aria-hidden="true">#</a></h2><p>You can define a public Docker image in your <code>.gitpod.yml</code> file with the following configuration:</p><div class="language-yaml"><span class="copy"></span><pre><code><span class="line"><span style="color:#F07178;">image</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">node:buster</span></span>
<span class="line"></span></code></pre></div><p>The official Gitpod Docker images are hosted on <a href="https://hub.docker.com/u/gitpod/" target="_blank">Docker Hub</a>.</p><p>You can find the source code for these images in <a href="https://github.com/gitpod-io/workspace-images/" target="_blank">this GitHub repository</a>.</p><h3 id="docker-image-tags" tabindex="-1">Docker image tags <a class="header-anchor" href="#docker-image-tags" aria-hidden="true">#</a></h3><p>For public images, feel free to specify a tag, e.g. <code>image: node:buster</code> if you are interested in a particular version of the Docker image.</p><p>For Gitpod images, we recommend using timestamped tag for maximum reproducibility, for example <code>image: gitpod/workspace-full:2022-05-08-14-31-53</code> (taken from the <code>Tags</code> panel on <a href="https://hub.docker.com/r/gitpod/workspace-full/tags" target="_blank" rel="noopener noreferrer">this dockerhub page</a> for example)</p><h2 id="configure-a-custom-dockerfile" tabindex="-1">Configure a custom Dockerfile <a class="header-anchor" href="#configure-a-custom-dockerfile" aria-hidden="true">#</a></h2><p>This option provides you with the most flexibility. Start by adding the following configuration in your <code>.gitpod.yml</code> file:</p><div class="language-yaml"><span class="copy"></span><pre><code><span class="line"><span style="color:#F07178;">image</span><span style="color:#89DDFF;">:</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">file</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C3E88D;">.gitpod.Dockerfile</span></span>
<span class="line"></span></code></pre></div><p>Next, create a <code>.gitpod.Dockerfile</code> file at the root of your project. The syntax is the regular <code>Dockerfile</code> syntax as <a href="https://docs.docker.com/engine/reference/builder/" target="_blank">documented on docs.docker.com</a>.</p><p>A good starting point for creating a custom <code>.gitpod.Dockerfile</code> is the <a href="https://github.com/gitpod-io/workspace-images/blob/481f7600b725e0ab507fbf8377641a562a475625/dazzle.yaml#L18" target="_blank">gitpod/workspace-full</a> image as it already contains all the tools necessary to work with all languages Gitpod supports.</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#676E95;font-style:italic;"># You can find the new timestamped tags here: https://hub.docker.com/r/gitpod/workspace-full/tags</span></span>
<span class="line"><span style="color:#A6ACCD;">FROM gitpod/workspace-full:2022-05-08-14-31-53</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Install custom tools, runtime, etc.</span></span>
<span class="line"><span style="color:#A6ACCD;">RUN brew install fzf</span></span>
<span class="line"></span></code></pre></div><p><strong>Docker support</strong>: If you use the <code>gitpod/workspace-full</code> image, you get Docker support built-in to your environment.</p><p>If you want a base image without the default tooling installed then use the <a href="https://github.com/gitpod-io/workspace-images/blob/481f7600b725e0ab507fbf8377641a562a475625/dazzle.yaml#L3" target="_blank">gitpod/workspace-base</a> image.</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#676E95;font-style:italic;"># You can find the new timestamped tags here: https://hub.docker.com/r/gitpod/workspace-base/tags</span></span>
<span class="line"><span style="color:#A6ACCD;">FROM gitpod/workspace-base:2022-05-08-14-31-53</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Install custom tools, runtime, etc.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># base image only got \`apt\` as the package manager</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># install-packages is a wrapper for \`apt\` that helps skip a few commands in the docker env.</span></span>
<span class="line"><span style="color:#A6ACCD;">RUN sudo install-packages shellcheck tree llvm</span></span>
<span class="line"></span></code></pre></div><p>When you launch a Gitpod workspace, the local console will use the <code>gitpod</code> user, so all local settings, config file, etc. should apply to <code>/home/gitpod</code> or be run using <code>USER gitpod</code> (we no longer recommend using <code>USER root</code>).</p><p>You can however use <code>sudo</code> in your Dockerfile. The following example shows a typical <code>.gitpod.Dockerfile</code> inheriting from <code>gitpod/workspace-full</code>:</p><div class="language-bash"><span class="copy"></span><pre><code><span class="line"><span style="color:#676E95;font-style:italic;"># You can find the new timestamped tags here: https://hub.docker.com/r/gitpod/workspace-full/tags</span></span>
<span class="line"><span style="color:#A6ACCD;">FROM gitpod/workspace-full:2022-05-08-14-31-53</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Install custom tools, runtime, etc.</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># install-packages is a wrapper for \`apt\` that helps skip a few commands in the docker env.</span></span>
<span class="line"><span style="color:#A6ACCD;">RUN sudo install-packages \\\\</span></span>
<span class="line"><span style="color:#A6ACCD;">          binwalk \\\\</span></span>
<span class="line"><span style="color:#A6ACCD;">          clang \\\\</span></span>
<span class="line"><span style="color:#A6ACCD;">          tmux</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># Apply user-specific settings</span></span>
<span class="line"></span></code></pre></div><p>Once committed and pushed, Gitpod will automatically build this Dockerfile when (or <a href="https://gitpod.io/docs/prebuilds" target="_blank" rel="noopener noreferrer">before</a>) new workspaces are created.</p><p>See also <a href="https://gitpod.io/blog/docker-in-gitpod" target="_blank" rel="noopener noreferrer">Gero&#39;s blog post</a> running through an example.</p><h2 id="trying-out-changes-to-your-dockerfile" tabindex="-1">Trying out changes to your Dockerfile <a class="header-anchor" href="#trying-out-changes-to-your-dockerfile" aria-hidden="true">#</a></h2><h3 id="in-the-existing-workspace" tabindex="-1">In the existing workspace <a class="header-anchor" href="#in-the-existing-workspace" aria-hidden="true">#</a></h3><p>Since the <code>.gitpod.Dockerfile</code> is a regular Dockerfile, you can build the image in your Gitpod workspace. This helps you catch syntax or build errors before you commit your changes.</p><p>To test your custom <code>.gitpod.Dockerfile</code>, run the following commands from the project root:</p><ol><li><code>docker build -f .gitpod.Dockerfile -t gitpod-dockerfile-test .</code></li><li><code>docker run -it gitpod-dockerfile-test bash</code></li></ol><p>This builds a <code>gitpod-dockerfile-test</code> image and starts a new container based on that image. At this point, you are connected to the Docker container that will be available as the foundation for your Gitpod workspace. You can inspect the container and make sure the necessary tools &amp; libraries are installed.</p><p>To exit the container and return back to your Gitpod workspace, type <code>exit</code>.</p><h3 id="as-a-new-workspace" tabindex="-1">As a new workspace <a class="header-anchor" href="#as-a-new-workspace" aria-hidden="true">#</a></h3><p>Once you validated the <code>.gitpod.Dockerfile</code> with the approach described in the previous chapter, it is time to start a new Gitpod workspace based on that custom image.</p><p>The easiest way to try out your changes is as follows:</p><ol><li>Create a new branch.</li><li>Commit your changes &amp; push the branch to your git hosting server.</li><li>Open a pull / merge request and open it in your browser.</li><li>Prefix the URL with <code>gitpod.io/#</code> and hit Enter.</li></ol><p>This starts a new workspace with your changes applied. You notice you now have two Gitpod workspaces running. The one where you made the changes and the new one, based on the pull request.</p><p><strong>Caution</strong>: Keeping the first workspace open is important in case your Dockerfile has bugs and prevents Gitpod from starting a workspace based on your pull request.</p><p>In the second workspace, the Docker build will start and show the output. If your Dockerfile has issues and the build fails or the resulting workspace does not look like you expected, you can force push changes to your config using your first, still running workspace and simply start a fresh workspace again to try them out.</p><p>We are working on allowing Docker builds directly from within workspaces, but until then this approach has been proven to be the most productive.</p><h2 id="manually-rebuild-a-workspace-image" tabindex="-1">Manually rebuild a workspace image <a class="header-anchor" href="#manually-rebuild-a-workspace-image" aria-hidden="true">#</a></h2><p>Sometimes you find yourself in situations where you want to manually rebuild a workspace image, for example if packages you rely on released a security fix.</p><p>You can trigger a workspace image rebuild with the following URL pattern: <code>https://gitpod.io/#imagebuild/&lt;your-repo-url&gt;</code>.</p>`,45),n=[i];function r(l,c,p,d,u,h){return o(),a("div",null,n)}var m=e(t,[["render",r]]);export{f as __pageData,m as default};
